#!/usr/bin/env python3

#
# Copyright (C) 2022 Nethesis S.r.l.
# SPDX-License-Identifier: GPL-3.0-or-later
#

import json
import sys
import agent
import os

# Parse user input
data = json.load(sys.stdin)

# Update ONLY user-configurable settings
# Passwords remain unchanged from create-module

# Update application settings if provided by user
if "LOG_LEVEL" in data:
    agent.set_env("LOG_LEVEL", data["LOG_LEVEL"])

# Update CORS/API URLs based on hostname
# The hostname comes from configure-module input
host = data.get("host", os.environ.get("TRAEFIK_HOST", "localhost"))

if host and host != "localhost":
    agent.set_env("CORS_ORIGIN", f"https://{host}")
    agent.set_env("NEXT_PUBLIC_API_URL", f"https://{host}/api")

# DO NOT regenerate passwords or secrets here!
# They are already set in create-module and must remain unchanged
